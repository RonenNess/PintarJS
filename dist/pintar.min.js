(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.PintarJS=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){"use strict";module.exports={AlphaBlend:"alpha",Opaque:"opaque",Additive:"additive",Multiply:"multiply",Subtract:"subtract",Screen:"screen",Overlay:"overlay",DestIn:"dest-in",DestOut:"dest-out"}},{}],2:[function(require,module,exports){"use strict";const PintarConsole=require("./console");class Color{constructor(r,g,b,a){this.set(r,g,b,a)}set(r,g,b,a){this._r=r;this._g=g;this._b=b;this._a=a;this._asHex=null}get r(){return this._r}get g(){return this._g}get b(){return this._b}get a(){return this._a}set r(val){this._r=val;this._asHex=null}set g(val){this._g=val;this._asHex=null}set b(val){this._b=val;this._asHex=null}set a(val){this._a=val;this._asHex=null}componentToHex(c){var hex=Math.round(c).toString(16);return hex.length==1?"0"+hex:hex}asHex(){if(!this._asHex){this._asHex="#"+this.componentToHex(this.r*255)+this.componentToHex(this.g*255)+this.componentToHex(this.b*255)+this.componentToHex(this.a*255)}return this._asHex}fromHex(val){var val=Color.fromHex(val);this.r=val.r;this.g=val.g;this.b=val.b;this.a=val.a}fromDecimal(val,includeAlpha){if(includeAlpha){this.a=(val&255)/255;val=val>>8}this.b=(val&255)/255;val=val>>8;this.g=(val&255)/255;val=val>>8;this.r=(val&255)/255}asDecimalRGBA(){return(Math.round(this.r*255)<<8*3|Math.round(this.g*255)<<8*2|Math.round(this.b*255)<<8*1|Math.round(this.a*255))>>>0}asDecimalABGR(){return(Math.round(this.a*255)<<8*3|Math.round(this.b*255)<<8*2|Math.round(this.g*255)<<8*1|Math.round(this.r*255))>>>0}clone(){return new Color(this.r,this.g,this.b,this.a)}get isTransparentBlack(){return this._r==this._g&&this._g==this._b&&this._b==this._a&&this._a==0}equals(other){return other&&this._r==other._r&&this._g==other._g&&this._b==other._b&&this._a==other._a}}var colorNameToHex={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};for(var key in colorNameToHex){if(colorNameToHex.hasOwnProperty(key)){var colorValue=hexToColor(colorNameToHex[key]);(function(_colValue){Color[key]=function(){return _colValue.clone()}})(colorValue)}}Color.transparent=function(){return new Color(0,0,0,0)};Color.transwhite=function(){return new Color(1,1,1,0)};function hexToColor(hex){var shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;hex=hex.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b});var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);var components=result?{r:parseInt(result[1],16)/255,g:parseInt(result[2],16)/255,b:parseInt(result[3],16)/255}:null;if(!components){throw new PintarConsole.Error("Invalid hex value to parse!")}return new Color(components.r,components.g,components.b,1)}Color.fromHex=function(colorHex){if(typeof colorHex!=="string"&&colorHex[0]!="#"){throw new PintarJS.Error("Invalid color format!")}var parsed=hexToColor(colorHex);if(!parsed){throw new PintarConsole.Error("Invalid hex value to parse!")}return new Color(parsed.r/255,parsed.g/255,parsed.b/255,1)};Color.fromDecimal=function(val){var ret=new Color;ret.fromDecimal(val);return ret};module.exports=Color},{"./console":3}],3:[function(require,module,exports){"use strict";class Console{}Console.silent=function(){Console.debug=Console.log=Console.warn=Console.error=function(){}};Console.log=function(){var context="PintarJS | "+(new Date).toLocaleString()+" |>";return Function.prototype.bind.call(console.log,console,context)}();Console.warn=function(){var context="PintarJS | "+(new Date).toLocaleString()+" | WARNING |>";return Function.prototype.bind.call(console.warn||console.log,console,context)}();Console.error=function(){var context="PintarJS | "+(new Date).toLocaleString()+" | ERROR |>";return Function.prototype.bind.call(console.error||console.log,console,context)}();Console.debug=function(){};Console.enableDebugMessages=function(){Console.debug=function(){var context="PintarJS | "+(new Date).toLocaleString()+" | DEBUG |>";return Function.prototype.bind.call(console.debug||console.log,console,context)}()};class PintarError extends Error{constructor(message="",...args){Console.error("Exception thrown:",message);super(message,...args);this.message="PintarJS Error: "+message}}Console.Error=PintarError;module.exports=Console},{}],4:[function(require,module,exports){"use strict";const Point=require("./point");const Rectangle=require("./rectangle");const Sprite=require("./sprite");const TextSprite=require("./text_sprite");const Color=require("./color");const Renderers=require("./renderers");const Texture=require("./texture");const BlendModes=require("./blend_modes");const Viewport=require("./viewport");const PintarConsole=require("./console");const __version__="1.0.0.5";const __author__="Ronen Ness";class PintarJS{constructor(canvas,rendererTypes){canvas=canvas||"canvas";if(typeof canvas==="string"||canvas instanceof String){canvas=document.querySelector(canvas)}if(!canvas||!canvas.getContext){throw new PintarConsole.Error("Invalid canvas provided!")}PintarConsole.log("Initialize PintarJS on canvas:",canvas);this._canvas=canvas;rendererTypes=rendererTypes||PintarJS.DefaultRenderers;if(!rendererTypes.length){rendererTypes=[rendererTypes]}var rendererTypesStr=[];for(var i=0;i<rendererTypes.length;++i){rendererTypesStr.push(rendererTypes[i].name||rendererTypes[i].constructor.name)}PintarConsole.log("Try to use renderers:",rendererTypesStr);for(var i=0;i<rendererTypes.length;++i){var renderer=rendererTypes[i];if(typeof renderer==="function"){renderer=new renderer}PintarConsole.log("Initialize renderer:",renderer.name||renderer.constructor.name);try{renderer._init(canvas);this._renderer=renderer;this._rendererName=rendererTypesStr[i];break}catch(err){PintarConsole.warn("Failed to init renderer, try fallback to next type..")}}if(!this._renderer){throw new PintarConsole.Error("Couldn't find a working renderer to use!")}this._frameStarted=false;this._fpsCount=0;this._currFps=0;this._deltaTime=0;this._secondCount=0;this.matchCanvasSizeToBounds=false;this.fixedResolutionX=null;this.fixedResolutionY=null;this.clearColor=Color.transparent();PintarConsole.log("PintarJS ready.")}makePixelatedScaling(){this._canvas.style.cssText+="image-rendering: optimizeSpeed;"+"image-rendering: -moz-crisp-edges;"+"image-rendering: -webkit-optimize-contrast;"+"image-rendering: -o-crisp-edges;"+"image-rendering: crisp-edges;"+"image-rendering: pixelated;"+"-ms-interpolation-mode: nearest-neighbor;"}get rendererName(){return this._rendererName}get canvas(){return this._canvas}adjustToParentSize(){var parentRect=this._canvas.parentElement.getBoundingClientRect();this._canvas.width=parentRect.width;this._canvas.height=parentRect.height-this._canvas.offsetTop}makeFullscreen(){this._canvas.style.position="fixed";this._canvas.style.left="0px";this._canvas.style.top="0px";this._canvas.style.right="0px";this._canvas.style.bottom="0px";this._canvas.style.width="100%";this._canvas.style.height="100%";this._canvas.style.display="block";this.matchCanvasSizeToBounds=true}startFrame(clearCanvas){if(this._frameStarted){throw new PintarConsole.Error("'startFrame()' was already called, must call 'endFrame()' before starting a new frame!")}if(clearCanvas||clearCanvas===undefined){this.clear()}this._doSizeAdjustments();this._renderer.startFrame();this._frameStarted=true;var currTime=(new Date).getTime();if(this._lastFrameTime){this._deltaTime=currTime-this._lastFrameTime}this._lastFrameTime=currTime;this._secondCount+=this.deltaTime;if(this._secondCount>1){this._secondCount=this._secondCount%1;this._fpsCount=this._currFps;this._currFps=-1}this._currFps++}_doSizeAdjustments(){if(this.fixedResolutionX||this.fixedResolutionY){if(this.fixedResolutionX&&this.fixedResolutionY){throw new PintarConsole.Error("Cannot set both 'fixedResolutionX' and 'fixedResolutionY', you must chose a single axis to base canvas size on.")}var canvasRect=this._canvas.getBoundingClientRect();var currWidth=this._canvas.width;var currHeight=this._canvas.height;if(this.fixedResolutionX){var scaledFactor=canvasRect.width/this.fixedResolutionX;var desiredWidth=this.fixedResolutionX;var desiredHeight=Math.round(canvasRect.height/scaledFactor)}else if(this.fixedResolutionY){var scaledFactor=canvasRect.height/this.fixedResolutionY;var desiredHeight=this.fixedResolutionY;var desiredWidth=Math.round(canvasRect.width/scaledFactor)}if(currWidth!=desiredWidth){this._canvas.width=desiredWidth}if(currHeight!=desiredHeight){this._canvas.height=desiredHeight}}else if(this.matchCanvasSizeToBounds){var canvasRect=this._canvas.getBoundingClientRect();var currWidth=this._canvas.width;var currHeight=this._canvas.height;if(currWidth!=canvasRect.width||currHeight!=canvasRect.height){this._canvas.width=canvasRect.width;this._canvas.height=canvasRect.height}}}get deltaTime(){return this._deltaTime/1e3}get fpsCount(){return this._fpsCount}endFrame(){this._renderer.endFrame();this._frameStarted=false}get canvasRect(){return new PintarJS.Rectangle(0,0,this._canvas.width,this._canvas.height)}clear(color,rect){color=color||this.clearColor;this._renderer.clear(color,rect)}setViewport(viewport){this._renderer.setViewport(viewport)}drawText(textSprite){if(!this._frameStarted){throw new PintarConsole.Error("Must call 'startFrame()' before drawing!")}if(!textSprite.text){return}this._renderer.drawText(textSprite)}drawSprite(sprite){if(!this._frameStarted){throw new PintarConsole.Error("Must call 'startFrame()' before drawing!")}this._renderer.drawSprite(sprite)}draw(obj){if(obj instanceof Sprite){this.drawSprite(obj)}else if(obj instanceof TextSprite){this.drawText(obj)}else{throw new PintarConsole.Error("Unknown object type to draw!")}}}PintarJS.Point=Point;PintarJS.Rectangle=Rectangle;PintarJS.Sprite=Sprite;PintarJS.TextSprite=TextSprite;PintarJS.TextAlignment=TextSprite._Alignments;PintarJS.BlendModes=BlendModes;PintarJS.Renderers=Renderers;PintarJS.Color=Color;PintarJS.DefaultRenderers=[Renderers.WebGL,Renderers.Canvas];PintarJS.Texture=Texture;PintarJS.Viewport=Viewport;PintarJS.silent=PintarConsole.silent;PintarJS.enableDebugMessages=PintarConsole.enableDebugMessages;PintarJS._version=__version__;PintarJS._author=__author__;PintarConsole.log("PintarJS v"+__version__+" ready! ðŸŽ¨");module.exports=PintarJS},{"./blend_modes":1,"./color":2,"./console":3,"./point":5,"./rectangle":6,"./renderers":10,"./sprite":18,"./text_sprite":19,"./texture":20,"./viewport":21}],5:[function(require,module,exports){"use strict";class Point{constructor(x,y){this.x=x||0;this.y=y||0}set(x,y){if(x!==null)this.x=x;if(y!==null)this.y=y}copy(other){this.x=other.x;this.y=other.y;return this}add(other){return new Point(this.x+other.x,this.y+other.y)}sub(other){return new Point(this.x-other.x,this.y-other.y)}div(other){return new Point(this.x/other.x,this.y/other.y)}mul(other){return new Point(this.x*other.x,this.y*other.y)}cross(other){return this.x*other.y-this.y*other.x}dot(other){return this.x*other.x+this.y*other.y}clone(){return new Point(this.x,this.y)}equals(other){return other&&this.x==other.x&&this.y==other.y}distance(other){var a=this.x-other.x;var b=this.y-other.y;return Math.sqrt(a*a+b*b)}}Point.zero=function(){return new Point(0,0)};Point.one=function(){return new Point(1,1)};Point.half=function(){return new Point(.5,.5)};module.exports=Point},{}],6:[function(require,module,exports){"use strict";const Point=require("./point");class Rectangle{constructor(x,y,width,height){this.x=x||0;this.y=y||0;this.width=width;this.height=height}set(x,y,width,height){this.x=x;this.y=y;this.width=width;this.height=height}getPosition(){return new Point(this.x,this.y)}getSize(){return new Point(this.width,this.height)}getCenter(){return new Point(Math.round(this.x+this.width/2),Math.round(this.y+this.height/2))}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}clone(){return new Rectangle(this.x,this.y,this.width,this.height)}equals(other){return other&&this.x==other.x&&this.y==other.y&&this.width==other.width&&this.height==other.height}}module.exports=Rectangle},{"./point":5}],7:[function(require,module,exports){"use strict";class Renderable{constructor(position,color,blendMode){this.position=position.clone();this.color=color.clone();this.blendMode=blendMode}get alpha(){return this.color.a}set alpha(val){this.color.a=val}_copyBasics(target){target.position=this.position.clone();target.color=this.color.clone();target.blendMode=this.blendMode}}module.exports=Renderable},{}],8:[function(require,module,exports){"use strict";const Renderer=require("./../renderer");const PintarConsole=require("./../../console");const Rectangle=require("./../../rectangle");const BlendModes=require("./../../blend_modes");const Point=require("./../../point");const Viewport=require("./../../viewport");const TextSprite=require("./../../text_sprite");class CanvasRenderer extends Renderer{_init(canvas){PintarConsole.debug("Initialize canvas renderer..");this._canvas=canvas;this._ctx=canvas.getContext("2d");if(!this._ctx){throw new PintarConsole.Error("Canvas API is not supported or canvas is already used with a different context!")}this.setViewport(null);PintarConsole.debug("Canvas renderer ready!")}startFrame(){this.setViewport(this._viewport)}endFrame(){this._currFont="null"}clear(color,rect){rect=rect||new Rectangle(0,0,this._canvas.width,this._canvas.height);if(color&&!color.isTransparentBlack){this._ctx.fillStyle=color.asHex();this._ctx.fillRect(rect.x,rect.y,rect.width,rect.height)}else{this._ctx.clearRect(rect.x,rect.y,rect.width,rect.height)}}setViewport(viewport){if(viewport){var drawingRegion=viewport.drawingRegion||new Rectangle(0,0,this._canvas.width,this._canvas.height);this._ctx.beginPath();this._ctx.rect(drawingRegion.x,drawingRegion.y,drawingRegion.width,drawingRegion.height);this._ctx.clip();this._lastViewportRegion=drawingRegion.clone();this._viewport=viewport}else{this._ctx.rect(0,0,this._canvas.width,this._canvas.height);this._ctx.clip();this._viewport=new Viewport(Point.zero(),null)}}_setBlendMode(blendMode){if(this._lastBlendMode!==blendMode){switch(blendMode){case BlendModes.AlphaBlend:this._ctx.globalCompositeOperation="source-over";break;case BlendModes.Opaque:this._ctx.globalCompositeOperation="source-over";break;case BlendModes.Additive:this._ctx.globalCompositeOperation="lighter";break;case BlendModes.Multiply:this._ctx.globalCompositeOperation="multiply";break;case BlendModes.Screen:this._ctx.globalCompositeOperation="screen";break;case BlendModes.Overlay:this._ctx.globalCompositeOperation="overlay";break;case BlendModes.Subtract:this._ctx.globalCompositeOperation="difference";break;case BlendModes.DestIn:this._ctx.globalCompositeOperation="source-over";break;case BlendModes.DestOut:this._ctx.globalCompositeOperation="destination-out";break;default:this._ctx.globalCompositeOperation="source-over";break}this._lastBlendMode=blendMode}}drawText(textSprite){var newFont=textSprite.fontPropertyAsString;if(this._currFont!==newFont){this._ctx.font=newFont;this._currFont=newFont}this._ctx.save();this._setBlendMode(textSprite.blendMode);this._ctx.textAlign=textSprite.alignment;var posX=Math.round(textSprite.position.x-this._viewport.offset.x);var posY=Math.round(textSprite.position.y-this._viewport.offset.y);var charsSizeCache={};var getCharSize=(char,strokeWidth)=>{if(char in charsSizeCache){return charsSizeCache[char]}var width=TextSprite.measureTextWidth(textSprite.font,textSprite.fontSize,char);var height=TextSprite.measureTextHeight(textSprite.font,textSprite.fontSize,char);var strokeExtra=0;var ret={base:new Point(width,height),withStroke:new Point(width+strokeExtra,height+strokeExtra),width:width+strokeExtra};charsSizeCache[char]=ret;return ret};var linesWithData=textSprite.getProcessedTextAndCommands(getCharSize);var lineHeight=textSprite.calculatedLineHeight;if(textSprite.strokeWidth){this._ctx.strokeStyle=textSprite.strokeColor.asHex();this._ctx.lineWidth=textSprite.strokeWidth;for(var i=0;i<linesWithData.length;++i){var line=linesWithData[i].text;this._ctx.strokeText(line,posX,posY+i*lineHeight)}}if(textSprite.color.a){this._ctx.fillStyle=textSprite.color.asHex();for(var i=0;i<linesWithData.length;++i){this._ctx.fillText(linesWithData[i].text,posX,posY+i*lineHeight)}}this._ctx.restore()}drawSprite(sprite){this._ctx.save();this._setBlendMode(sprite.blendMode);this._ctx.imageSmoothingEnabled=sprite.smoothingEnabled;this._ctx.globalAlpha=sprite.color.a;var width=sprite.width;var height=sprite.height;var originWidth=sprite.origin.x*width;var originHeight=sprite.origin.y*height;if(this._lastBrightness!==sprite.brightness){this._ctx.filter="brightness("+sprite.brightness*100+"%)";this._lastBrightness=sprite.brightness}if(sprite.rotationRadians!==0||sprite.skew.x!==0||sprite.skew.y!==0||sprite.scale.x!==1||sprite.scale.y!==1){var origin=new Point(sprite.position.x,sprite.position.y);this._ctx.translate(origin.x,origin.y);if(sprite.rotationRadians!=0){this._ctx.rotate(sprite.rotationRadians)}if(sprite.skew.x!=0){this._ctx.transform(1,0,Math.tan(sprite.skew.x*.85),1,0,0)}if(sprite.skew.y!=0){this._ctx.transform(1,Math.tan(sprite.skew.y*.85),0,1,0,0)}this._ctx.scale(sprite.scale.x,sprite.scale.y);this._ctx.translate(-origin.x-originWidth,-origin.y-originHeight)}var srcRect=sprite.sourceRectangle;this._ctx.drawImage(sprite.texture.image,srcRect.x,srcRect.y,srcRect.width||sprite.texture.width,srcRect.height||sprite.texture.height,sprite.position.x-this._viewport.offset.x,sprite.position.y-this._viewport.offset.y,width,height);this._ctx.restore()}}module.exports=CanvasRenderer},{"./../../blend_modes":1,"./../../console":3,"./../../point":5,"./../../rectangle":6,"./../../text_sprite":19,"./../../viewport":21,"./../renderer":11}],9:[function(require,module,exports){"use strict";module.exports=require("./canvas")},{"./canvas":8}],10:[function(require,module,exports){"use strict";module.exports={Canvas:require("./canvas"),WebGL:require("./webgl"),WebGLHybrid:require("./webgl/webgl_hybrid")}},{"./canvas":9,"./webgl":13,"./webgl/webgl_hybrid":16}],11:[function(require,module,exports){"use strict";const PintarConsole=require("./../console");class Renderer{_init(canvas){throw new PintarConsole.Error("Not Implemented.")}clear(color,rect){throw new PintarConsole.Error("Not Implemented.")}drawText(textSprite){throw new PintarConsole.Error("Not Implemented.")}drawSprite(sprite){throw new PintarConsole.Error("Not Implemented.")}setViewport(viewport){throw new PintarConsole.Error("Not Implemented.")}startFrame(){}endFrame(){}}module.exports=Renderer},{"./../console":3}],12:[function(require,module,exports){"use strict";const Point=require("../../point");const Rectangle=require("../../rectangle");const Texture=require("./../../texture");const PintarConsole=require("./../../console");const TextSprite=require("./../../text_sprite");const defaultAsciiChars=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~Â Â¡Â¢Â£Â¤Â¥Â¦Â§Â¨Â©ÂªÂ«Â¬Â­Â®Â¯Â°Â±Â²Â³Â´ÂµÂ¶Â·Â¸Â¹ÂºÂ»Â¼Â½Â¾";function makePowerTwo(val){var ret=2;while(ret<val){ret=ret*2;if(ret>=val){return ret}}return ret}var measureTextHeight=TextSprite.measureTextHeight;var measureTextWidth=TextSprite.measureTextWidth;class FontTexture{constructor(fontName,fontSize,charsSet,maxTextureWidth,missingCharPlaceholder){missingCharPlaceholder=(missingCharPlaceholder||"?")[0];this._placeholderChar=missingCharPlaceholder;maxTextureWidth=maxTextureWidth||2048;charsSet=charsSet||defaultAsciiChars;if(charsSet.indexOf(missingCharPlaceholder)===-1){charsSet+=missingCharPlaceholder}this.fontName=fontName||"Ariel";this.fontSize=fontSize||30;var margin={x:10,y:10};var fontFullName=this.fontSize.toString()+"px "+(fontName||"Ariel");var fontHeight=measureTextHeight(this.fontName,this.fontSize);var fontWidth=measureTextWidth(this.fontName,this.fontSize);var estimatedCharSizeInTexture=new Point(fontWidth+margin.x*2,fontHeight+margin.y*2);var charsPerRow=Math.floor(maxTextureWidth/estimatedCharSizeInTexture.x);var textureWidth=Math.min(charsSet.length*estimatedCharSizeInTexture.x,maxTextureWidth);var textureHeight=Math.ceil(charsSet.length/charsPerRow)*estimatedCharSizeInTexture.y;if(FontTexture.enforceValidTexureSize){textureWidth=makePowerTwo(textureWidth);textureHeight=makePowerTwo(textureHeight)}this._sourceRects={};var canvas=document.createElement("canvas");canvas.width=textureWidth;canvas.height=textureHeight;var ctx=canvas.getContext("2d");ctx.font=fontFullName;ctx.fillStyle="#ffffffff";PintarConsole.debug("Generate Font Texture:",ctx.font,"Chars set: ",charsSet," Texture size: ",textureWidth,textureHeight);var x=0;var y=0;for(var i=0;i<charsSet.length;++i){var currChar=charsSet[i];var currCharWidth=Math.ceil(ctx.measureText(currChar).width);if(x+currCharWidth>textureWidth){y+=fontHeight+margin.y;x=0}var sourceRect=new Rectangle(x,y+fontHeight/4,currCharWidth,fontHeight);this._sourceRects[currChar]=sourceRect;ctx.fillText(currChar,x,y+fontHeight);x+=currCharWidth+margin.x}var img=new Image;img.src=canvas.toDataURL("image/png");this._texture=new Texture(img,null)}get texture(){return this._texture}getSourceRect(char){return this._sourceRects[char]||this._sourceRects[this._placeholderChar]}}FontTexture.enforceValidTexureSize=true;module.exports=FontTexture},{"../../point":5,"../../rectangle":6,"./../../console":3,"./../../text_sprite":19,"./../../texture":20}],13:[function(require,module,exports){"use strict";module.exports=require("./webgl")},{"./webgl":15}],14:[function(require,module,exports){"use strict";const vsSource=`\n// input position and texture coord\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\n\n// screen resolution to project quad\nuniform vec2 u_resolution;\n\n// to set position, size and texture offset from code\n// note: u_size only works if quad is made with 0-1 values\nuniform vec2 u_offset;\nuniform vec2 u_size;\nuniform vec2 u_textureOffset;\nuniform vec2 u_textureSize;\nuniform vec2 u_rotation;\nuniform vec2 u_origin;\nuniform vec2 u_skew;\n\n// output texture coord\nvarying vec2 v_texCoord;\n\n// main vertex shader func\nvoid main() \n{\n    // apply size and origin\n    vec2 position = (a_position * u_size - u_origin * u_size);\n\n    // apply skew\n    position.y += u_skew.y * position.x;\n    position.x += u_skew.x * position.y;\n\n    // apply rotation and resolution\n    position = (vec2(\n        position.x * u_rotation.y + position.y * u_rotation.x,\n        position.y * u_rotation.y - position.x * u_rotation.x\n    ));\n\n    // convert from pixels into 0-2 values\n    vec2 zeroToTwo = (position / u_resolution) * 2.0;\n\n    // convert from 0->2 to -1->+1 (clipspace) and invert position y\n    vec2 clipSpace = zeroToTwo - 1.0;\n    clipSpace.y *= -1.0;\n\n    // set output position\n    gl_Position = vec4(clipSpace + ((u_offset * 2.0) / u_resolution), 0, 1);\n\n    // pass the texCoord to the fragment shader\n    // The GPU will interpolate this value between points.\n    v_texCoord = a_texCoord * u_textureSize + u_textureOffset;\n}\n`;const fsSource=`\nprecision mediump float;\n\n// our texture\nuniform sampler2D u_image;\n\n// color tint and enhancer\nuniform vec4 u_color;\nuniform vec4 u_colorBooster;\n\n// the texCoords passed in from the vertex shader.\nvarying vec2 v_texCoord;\n\n// main fragment shader func\nvoid main() \n{\n   gl_FragColor = clamp(texture2D(u_image, v_texCoord) + u_colorBooster, 0.0, 1.0) * u_color;\n   gl_FragColor.rgb *= min(gl_FragColor.a, 1.0);\n}\n`;module.exports={vertex:vsSource,fragment:fsSource}},{}],15:[function(require,module,exports){"use strict";const Renderer=require("./../renderer");const PintarConsole=require("./../../console");const Point=require("./../../point");const Sprite=require("./../../sprite");const Color=require("./../../color");const BlendModes=require("../../blend_modes");const Viewport=require("./../../viewport");const Rectangle=require("./../../rectangle");const Shaders=require("./shaders");const FontTexture=require("./font_texture");const WebglUtils=require("./webgl_utils").webglUtils;const nullImg=new Image;nullImg.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAAFElEQVQYV2NkYGD4z8DAwMAIYwAAExoCAZK/WvgAAAAASUVORK5CYII=";class WebGlRenderer extends Renderer{_init(canvas){PintarConsole.debug("Initialize WebGL renderer..");this._canvas=canvas;this._gl=canvas.getContext("webgl2",{premultipliedAlpha:true});if(!this._gl){PintarConsole.warn("Failed to get WebGL v2, fallback to WebGL v1 instead. Some feature may not be available.");canvas.getContext("webgl",{premultipliedAlpha:true})}if(!this._gl){throw new PintarConsole.Error("WebGL is not supported or canvas is already used with a different context!")}this._initShadersAndBuffers();this.fontTextureDefaultSize=100;this.smoothText=true;this._fontTextures={};PintarConsole.debug("WebGL renderer ready!")}_initShadersAndBuffers(){var gl=this._gl;var program=WebglUtils.createProgramFromSources(gl,[Shaders.vertex,Shaders.fragment],undefined,undefined,reason=>{throw new PintarConsole.Error(reason)});this._program=program;var positionLocation=gl.getAttribLocation(program,"a_position");var texcoordLocation=gl.getAttribLocation(program,"a_texCoord");var positionBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,positionBuffer);gl.disable(gl.DEPTH_TEST);gl.disable(gl.CULL_FACE);gl.disable(gl.STENCIL_TEST);var setRectangle=function(gl,x,y,width,height){var x1=x;var x2=x+width;var y1=y;var y2=y+height;gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([x1,y1,x2,y1,x1,y2,x2,y2]),gl.STATIC_DRAW)};setRectangle(gl,0,0,1,1);var texcoordBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,texcoordBuffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,1,1]),gl.STATIC_DRAW);gl.useProgram(program);gl.enableVertexAttribArray(positionLocation);gl.bindBuffer(gl.ARRAY_BUFFER,positionBuffer);var size=2;var type=gl.FLOAT;var normalize=false;var stride=0;var offset=0;gl.vertexAttribPointer(positionLocation,size,type,normalize,stride,offset);gl.enableVertexAttribArray(texcoordLocation);gl.bindBuffer(gl.ARRAY_BUFFER,texcoordBuffer);var size=2;var type=gl.FLOAT;var normalize=false;var stride=0;var offset=0;gl.vertexAttribPointer(texcoordLocation,size,type,normalize,stride,offset);this._uniforms={offset:gl.getUniformLocation(this._program,"u_offset"),size:gl.getUniformLocation(this._program,"u_size"),skew:gl.getUniformLocation(this._program,"u_skew"),textureOffset:gl.getUniformLocation(this._program,"u_textureOffset"),textureSize:gl.getUniformLocation(this._program,"u_textureSize"),color:gl.getUniformLocation(this._program,"u_color"),colorBooster:gl.getUniformLocation(this._program,"u_colorBooster"),rotation:gl.getUniformLocation(this._program,"u_rotation"),origin:gl.getUniformLocation(this._program,"u_origin")};for(var key in this._uniforms){if(this._uniforms.hasOwnProperty(key)){this._uniforms[key]._lastVal={}}}this._onResize()}_onResize(){var gl=this._gl;var resolutionLocation=gl.getUniformLocation(this._program,"u_resolution");gl.uniform2f(resolutionLocation,gl.canvas.width,gl.canvas.height);gl.viewport(0,0,gl.canvas.width,gl.canvas.height);this._lastSize=new Point(gl.canvas.width,gl.canvas.height)}startFrame(){if(this._lastSize.x!=this._gl.canvas.width||this._lastSize.y!=this._gl.canvas.height){this._onResize()}this._currTexture=null;this._lastBlend=null;this._smoothing=null}endFrame(){}clear(color,rect){if(!rect){this._gl.clearColor(color.r,color.g,color.b,color.a);this._gl.clear(this._gl.COLOR_BUFFER_BIT)}else{this._gl.enable(this._gl.SCISSOR_TEST);this._setScissor(rect);this._gl.clearColor(color.r,color.g,color.b,color.a);this._gl.clear(this._gl.COLOR_BUFFER_BIT);this._gl.disable(this._gl.SCISSOR_TEST)}this.setViewport(this._viewport)}generateFontTexture(fontName,fontSize,charsSet,maxTextureWidth,missingCharPlaceholder){var ret=new FontTexture(fontName,fontSize,charsSet,maxTextureWidth,missingCharPlaceholder);this._fontTextures[fontName]=ret;return ret}_getOrCreateFontTexture(fontName){if(!this._fontTextures[fontName]){this.generateFontTexture(fontName,this.fontTextureDefaultSize)}return this._fontTextures[fontName]}setViewport(viewport){if(viewport){var rect=viewport.drawingRegion||new Rectangle(0,0,this._canvas.width,this._canvas.height);this._setScissor(rect);this._gl.enable(this._gl.SCISSOR_TEST);this._viewport=viewport}else{this._gl.disable(this._gl.SCISSOR_TEST);this._viewport=new Viewport(Point.zero(),null)}}_setScissor(rect){this._gl.scissor(rect.x,this._canvas.height-rect.y-rect.height,rect.width,rect.height)}drawText(textSprite){var fontTexture=this._getOrCreateFontTexture(textSprite.font);var sprite=new Sprite(fontTexture.texture);var fillColor=null;var strokeWidth=null;var strokeColor=null;var ratio=textSprite.fontSize/fontTexture.fontSize;var charsSizeCache={};var getCharSize=(char,strokeWidth)=>{if(char in charsSizeCache){return charsSizeCache[char]}var srcRect=fontTexture.getSourceRect(char);var width=Math.ceil(ratio*srcRect.width);var height=Math.ceil(ratio*srcRect.height);var strokeExtra=strokeWidth/5;var ret={base:new Point(width,height),withStroke:new Point(width+strokeExtra,height+strokeExtra),width:width+strokeExtra-1*ratio};charsSizeCache[char]=ret;return ret};var lines=textSprite.getProcessedTextAndCommands(getCharSize);var drawText=drawSpriteMethod=>{for(var i=0;i<lines.length;++i){var line=lines[i];var lineWidth=line.totalWidth;var offset=0;switch(textSprite.alignment){case"right":offset-=lineWidth;break;case"center":offset-=lineWidth/2;break}for(var j=0;j<line.text.length;++j){if(textSprite.useStyleCommands&&line.styleCommands[j]){var styleCommands=line.styleCommands[j];for(var _x=0;_x<styleCommands.length;++_x){var styleCommand=styleCommands[_x];switch(styleCommand.type){case"reset":fillColor=strokeWidth=strokeColor=null;break;case"fc":fillColor=styleCommand.val;break;case"sc":strokeColor=styleCommand.val;break;case"sw":strokeWidth=styleCommand.val;break}}}var char=line.text[j];var srcRect=fontTexture.getSourceRect(char);var size=line.sizes[j];if(fillColor===null){fillColor=textSprite.color}if(strokeWidth===null){strokeWidth=textSprite.strokeWidth}if(strokeColor===null){strokeColor=textSprite.strokeColor}sprite.sourceRectangle=srcRect;var posX=textSprite.position.x+offset;var posY=textSprite.position.y+(i-.75)*textSprite.calculatedLineHeight;var position=new Point(posX,posY);sprite.width=size.base.x;sprite.height=size.base.y;sprite.smoothingEnabled=this.smoothText;sprite.position.set(position.x,position.y);drawSpriteMethod(sprite,position,fillColor,strokeWidth,strokeColor);offset+=size.withStroke.x-1*ratio}}};drawText((sprite,position,fillColor,strokeWidth,strokeColor)=>{var width=sprite.width;var height=sprite.height;if(strokeWidth>0&&strokeColor.a>0){sprite.color=strokeColor;for(var sx=-1;sx<=1;sx++){for(var sy=-1;sy<=1;sy++){var centerPart=sx==0&&sy==0;var extraWidth=centerPart?strokeWidth:0;var extraHeight=centerPart?strokeWidth:0;sprite.width=width+extraWidth;sprite.height=height+extraHeight;sprite.position.x=position.x+sx*(strokeWidth/2.5)-extraWidth/2;sprite.position.y=position.y+sy*(strokeWidth/2.5)-extraHeight/2;this.drawSprite(sprite)}}}});drawText((sprite,position,fillColor,strokeWidth,strokeColor)=>{sprite.color=fillColor;this.drawSprite(sprite)})}_setUniform2(uniform,x,y){if(uniform._lastVal.x!==x||uniform._lastVal.y!==y){uniform._lastVal.x=x;uniform._lastVal.y=y;this._gl.uniform2f(uniform,x,y)}}_setUniform4(uniform,x,y,z,w){if(uniform._lastVal.x!==x||uniform._lastVal.y!==y||uniform._lastVal.z!==z||uniform._lastVal.w!==w){uniform._lastVal.x=x;uniform._lastVal.y=y;uniform._lastVal.z=z;uniform._lastVal.w=w;this._gl.uniform4f(uniform,x,y,z,w)}}_setTexture(texture,textureMode){var gl=this._gl;var img=texture.image;texture._glTextures=texture._glTextures||{};if(this._currTexture!==texture||this._currTextureMode!==textureMode){this._smoothing=null;this._currTextureMode=textureMode;this._currTexture=texture;if(!texture._glTextures[textureMode]&&img.width&&img.height&&img.complete){var gltexture=gl.createTexture();if(!gltexture){throw new PintarConsole.Error("Invalid texture! Internal error?")}gl.bindTexture(gl.TEXTURE_2D,gltexture);gl.texImage2D(gl.TEXTURE_2D,0,textureMode,img.width,img.height,0,textureMode,gl.UNSIGNED_BYTE,img);texture._glTextures[textureMode]=gltexture}else{var gltexture=texture._glTextures[textureMode];gl.bindTexture(gl.TEXTURE_2D,gltexture)}}}_setSmoothingEnabled(smoothing){if(this._smoothing===smoothing){return}this._smoothing=smoothing;var gl=this._gl;if(smoothing){gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR)}else{gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST)}}_setBlendMode(blendMode){if(this._lastBlend!==blendMode){var gl=this._gl;gl.enable(gl.BLEND);gl.blendEquation(gl.FUNC_ADD);switch(blendMode){case BlendModes.AlphaBlend:gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA);break;case BlendModes.Opaque:gl.disable(gl.BLEND);break;case BlendModes.Additive:gl.blendFunc(gl.ONE,gl.ONE);break;case BlendModes.Multiply:gl.blendFuncSeparate(gl.DST_COLOR,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA);break;case BlendModes.Screen:gl.blendFuncSeparate(gl.ONE,gl.ONE_MINUS_SRC_COLOR,gl.ONE,gl.ONE_MINUS_SRC_ALPHA);break;case BlendModes.Subtract:gl.blendFuncSeparate(gl.ONE,gl.ONE,gl.ONE,gl.ONE);gl.blendEquationSeparate(gl.FUNC_REVERSE_SUBTRACT,gl.FUNC_ADD);break;case BlendModes.Overlay:if(gl.MAX){gl.blendEquation(gl.MAX);gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA)}else{gl.blendFunc(gl.ONE,gl.ONE)}break;case BlendModes.DestIn:gl.blendFunc(gl.ZERO,gl.SRC_ALPHA);break;case BlendModes.DestOut:gl.blendFunc(gl.ZERO,gl.ONE_MINUS_SRC_ALPHA);break;default:gl.blendFuncSeparate(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA);break}this._lastBlend=blendMode}}_calcTextureMode(sprite){var textMode=this._gl.RGBA;var opaque=sprite.blendMode==BlendModes.Opaque;var greyscale=sprite.greyscale;if(opaque&&greyscale){textMode=this._gl.LUMINANCE}else if(opaque){textMode=this._gl.RGB}else if(greyscale){textMode=this._gl.LUMINANCE_ALPHA}return textMode}drawSprite(sprite){if(!sprite.texture.isReady){return}var textureMode=this._calcTextureMode(sprite);this._setTexture(sprite.texture,textureMode);this._gl.uniform2f(this._uniforms.offset,sprite.position.x-this._viewport.offset.x,-sprite.position.y+this._viewport.offset.y);this._setUniform2(this._uniforms.size,sprite.width*sprite.scale.x,sprite.height*sprite.scale.y);var srcRect=sprite.sourceRectangleRelative;this._setUniform2(this._uniforms.textureOffset,srcRect.x,srcRect.y);this._setUniform2(this._uniforms.textureSize,srcRect.width,srcRect.height);this._setUniform4(this._uniforms.color,sprite.color.r*sprite.brightness,sprite.color.g*sprite.brightness,sprite.color.b*sprite.brightness,sprite.color.a);this._setUniform4(this._uniforms.colorBooster,sprite.colorBoost.r,sprite.colorBoost.g,sprite.colorBoost.b,sprite.colorBoost.a);this._setUniform2(this._uniforms.skew,sprite.skew.x,sprite.skew.y);var rotation=sprite.rotationVector;this._setUniform2(this._uniforms.rotation,rotation.x,rotation.y);this._setUniform2(this._uniforms.origin,sprite.origin.x,sprite.origin.y);this._setSmoothingEnabled(sprite.smoothingEnabled);this._setBlendMode(sprite.blendMode);this._gl.drawArrays(this._gl.TRIANGLE_STRIP,0,4)}}module.exports=WebGlRenderer},{"../../blend_modes":1,"./../../color":2,"./../../console":3,"./../../point":5,"./../../rectangle":6,"./../../sprite":18,"./../../viewport":21,"./../renderer":11,"./font_texture":12,"./shaders":14,"./webgl_utils":17}],16:[function(require,module,exports){"use strict";const WebGlBase=require("./webgl");const PintarConsole=require("../../console");const CanvasRenderer=require("../canvas");const Color=require("../../color");class WebGlHybridRenderer extends WebGlBase{_init(canvas){super._init(canvas);this._initOverlayCanvas()}_initOverlayCanvas(){PintarConsole.debug("Create internal canvas renderer to use as overlay layer for text..");var canvas=this._canvas;this._overlayCanvas=document.createElement("canvas");this._overlayCanvas.id="pintarjs-webgl-overlay-canvas";this._overlayCanvasRender=new CanvasRenderer;this._overlayCanvasRender._init(this._overlayCanvas);this._updateOverlayCanvas();canvas.parentNode.insertBefore(this._overlayCanvas,canvas.nextSibling);PintarConsole.debug("Done creating canvas renderer.")}_updateOverlayCanvas(){if(this._overlayCanvas.width!=this._canvas.width){this._overlayCanvas.width=this._canvas.width}if(this._overlayCanvas.height!=this._canvas.height){this._overlayCanvas.height=this._canvas.height}var rect=this._canvas.getBoundingClientRect();if(this._lastBounding&&(this._lastBounding.left===rect.left&&this._lastBounding.right===rect.right&&this._lastBounding.top===rect.top&&this._lastBounding.bottom===rect.bottom)){return}this._lastBounding=rect;this._overlayCanvas.style.position="fixed";this._overlayCanvas.style.zIndex=this._canvas.style.zIndex+1;this._overlayCanvas.style.display="block";this._overlayCanvas.style.left=rect.left+"px";this._overlayCanvas.style.right=rect.right+"px";this._overlayCanvas.style.top=rect.top+"px";this._overlayCanvas.style.bottom=rect.bottom+"px";this._overlayCanvas.style.width=this._canvas.style.width;this._overlayCanvas.style.height=this._canvas.style.height}startFrame(){super.startFrame();this._updateOverlayCanvas()}clear(color,rect){this._overlayCanvasRender.clear(new Color(0,0,0,0));super.clear(color,rect)}setViewport(viewport){this._overlayCanvasRender.setViewport(viewport);super.setViewport(viewport)}drawText(textSprite){this._overlayCanvasRender.drawText(textSprite)}}module.exports=WebGlHybridRenderer},{"../../color":2,"../../console":3,"../canvas":9,"./webgl":15}],17:[function(require,module,exports){(function(root,factory){if(typeof define==="function"&&define.amd){define([],function(){return factory.call(root)})}else{root.webglUtils=factory.call(root)}})(this,function(){"use strict";var topWindow=this;function isInIFrame(w){w=w||topWindow;return w!==w.top}if(!isInIFrame()){console.log("%c%s","color:blue;font-weight:bold;","for more about webgl-utils.js see:");console.log("%c%s","color:blue;font-weight:bold;","http://webglfundamentals.org/webgl/lessons/webgl-boilerplate.html")}function error(msg){if(topWindow.console){if(topWindow.console.error){topWindow.console.error(msg)}else if(topWindow.console.log){topWindow.console.log(msg)}}}function loadShader(gl,shaderSource,shaderType,opt_errorCallback){var errFn=opt_errorCallback||error;var shader=gl.createShader(shaderType);gl.shaderSource(shader,shaderSource);gl.compileShader(shader);var compiled=gl.getShaderParameter(shader,gl.COMPILE_STATUS);if(!compiled){var lastError=gl.getShaderInfoLog(shader);errFn("*** Error compiling shader '"+shader+"':"+lastError);gl.deleteShader(shader);return null}return shader}function createProgram(gl,shaders,opt_attribs,opt_locations,opt_errorCallback){var errFn=opt_errorCallback||error;var program=gl.createProgram();shaders.forEach(function(shader){gl.attachShader(program,shader)});if(opt_attribs){opt_attribs.forEach(function(attrib,ndx){gl.bindAttribLocation(program,opt_locations?opt_locations[ndx]:ndx,attrib)})}gl.linkProgram(program);var linked=gl.getProgramParameter(program,gl.LINK_STATUS);if(!linked){var lastError=gl.getProgramInfoLog(program);errFn("Error in program linking:"+lastError);gl.deleteProgram(program);return null}return program}function createShaderFromScript(gl,scriptId,opt_shaderType,opt_errorCallback){var shaderSource="";var shaderType;var shaderScript=document.getElementById(scriptId);if(!shaderScript){throw"*** Error: unknown script element"+scriptId}shaderSource=shaderScript.text;if(!opt_shaderType){if(shaderScript.type==="x-shader/x-vertex"){shaderType=gl.VERTEX_SHADER}else if(shaderScript.type==="x-shader/x-fragment"){shaderType=gl.FRAGMENT_SHADER}else if(shaderType!==gl.VERTEX_SHADER&&shaderType!==gl.FRAGMENT_SHADER){throw"*** Error: unknown shader type"}}return loadShader(gl,shaderSource,opt_shaderType?opt_shaderType:shaderType,opt_errorCallback)}var defaultShaderType=["VERTEX_SHADER","FRAGMENT_SHADER"];function createProgramFromScripts(gl,shaderScriptIds,opt_attribs,opt_locations,opt_errorCallback){var shaders=[];for(var ii=0;ii<shaderScriptIds.length;++ii){shaders.push(createShaderFromScript(gl,shaderScriptIds[ii],gl[defaultShaderType[ii]],opt_errorCallback))}return createProgram(gl,shaders,opt_attribs,opt_locations,opt_errorCallback)}function createProgramFromSources(gl,shaderSources,opt_attribs,opt_locations,opt_errorCallback){var shaders=[];for(var ii=0;ii<shaderSources.length;++ii){shaders.push(loadShader(gl,shaderSources[ii],gl[defaultShaderType[ii]],opt_errorCallback))}return createProgram(gl,shaders,opt_attribs,opt_locations,opt_errorCallback)}function getBindPointForSamplerType(gl,type){if(type===gl.SAMPLER_2D)return gl.TEXTURE_2D;if(type===gl.SAMPLER_CUBE)return gl.TEXTURE_CUBE_MAP;return undefined}function createUniformSetters(gl,program){var textureUnit=0;function createUniformSetter(program,uniformInfo){var location=gl.getUniformLocation(program,uniformInfo.name);var type=uniformInfo.type;var isArray=uniformInfo.size>1&&uniformInfo.name.substr(-3)==="[0]";if(type===gl.FLOAT&&isArray){return function(v){gl.uniform1fv(location,v)}}if(type===gl.FLOAT){return function(v){gl.uniform1f(location,v)}}if(type===gl.FLOAT_VEC2){return function(v){gl.uniform2fv(location,v)}}if(type===gl.FLOAT_VEC3){return function(v){gl.uniform3fv(location,v)}}if(type===gl.FLOAT_VEC4){return function(v){gl.uniform4fv(location,v)}}if(type===gl.INT&&isArray){return function(v){gl.uniform1iv(location,v)}}if(type===gl.INT){return function(v){gl.uniform1i(location,v)}}if(type===gl.INT_VEC2){return function(v){gl.uniform2iv(location,v)}}if(type===gl.INT_VEC3){return function(v){gl.uniform3iv(location,v)}}if(type===gl.INT_VEC4){return function(v){gl.uniform4iv(location,v)}}if(type===gl.BOOL){return function(v){gl.uniform1iv(location,v)}}if(type===gl.BOOL_VEC2){return function(v){gl.uniform2iv(location,v)}}if(type===gl.BOOL_VEC3){return function(v){gl.uniform3iv(location,v)}}if(type===gl.BOOL_VEC4){return function(v){gl.uniform4iv(location,v)}}if(type===gl.FLOAT_MAT2){return function(v){gl.uniformMatrix2fv(location,false,v)}}if(type===gl.FLOAT_MAT3){return function(v){gl.uniformMatrix3fv(location,false,v)}}if(type===gl.FLOAT_MAT4){return function(v){gl.uniformMatrix4fv(location,false,v)}}if((type===gl.SAMPLER_2D||type===gl.SAMPLER_CUBE)&&isArray){var units=[];for(var ii=0;ii<info.size;++ii){units.push(textureUnit++)}return function(bindPoint,units){return function(textures){gl.uniform1iv(location,units);textures.forEach(function(texture,index){gl.activeTexture(gl.TEXTURE0+units[index]);gl.bindTexture(bindPoint,texture)})}}(getBindPointForSamplerType(gl,type),units)}if(type===gl.SAMPLER_2D||type===gl.SAMPLER_CUBE){return function(bindPoint,unit){return function(texture){gl.uniform1i(location,unit);gl.activeTexture(gl.TEXTURE0+unit);gl.bindTexture(bindPoint,texture)}}(getBindPointForSamplerType(gl,type),textureUnit++)}throw"unknown type: 0x"+type.toString(16)}var uniformSetters={};var numUniforms=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS);for(var ii=0;ii<numUniforms;++ii){var uniformInfo=gl.getActiveUniform(program,ii);if(!uniformInfo){break}var name=uniformInfo.name;if(name.substr(-3)==="[0]"){name=name.substr(0,name.length-3)}var setter=createUniformSetter(program,uniformInfo);uniformSetters[name]=setter}return uniformSetters}function setUniforms(setters,values){setters=setters.uniformSetters||setters;Object.keys(values).forEach(function(name){var setter=setters[name];if(setter){setter(values[name])}})}function createAttributeSetters(gl,program){var attribSetters={};function createAttribSetter(index){return function(b){gl.bindBuffer(gl.ARRAY_BUFFER,b.buffer);gl.enableVertexAttribArray(index);gl.vertexAttribPointer(index,b.numComponents||b.size,b.type||gl.FLOAT,b.normalize||false,b.stride||0,b.offset||0)}}var numAttribs=gl.getProgramParameter(program,gl.ACTIVE_ATTRIBUTES);for(var ii=0;ii<numAttribs;++ii){var attribInfo=gl.getActiveAttrib(program,ii);if(!attribInfo){break}var index=gl.getAttribLocation(program,attribInfo.name);attribSetters[attribInfo.name]=createAttribSetter(index)}return attribSetters}function setAttributes(setters,attribs){setters=setters.attribSetters||setters;Object.keys(attribs).forEach(function(name){var setter=setters[name];if(setter){setter(attribs[name])}})}function createVAOAndSetAttributes(gl,setters,attribs,indices){var vao=gl.createVertexArray();gl.bindVertexArray(vao);setAttributes(setters,attribs);if(indices){gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,indices)}gl.bindVertexArray(null);return vao}function createVAOFromBufferInfo(gl,programInfo,bufferInfo){return createVAOAndSetAttributes(gl,programInfo.attribSetters||programInfo,bufferInfo.attribs,bufferInfo.indices)}function createProgramInfo(gl,shaderSources,opt_attribs,opt_locations,opt_errorCallback){shaderSources=shaderSources.map(function(source){var script=document.getElementById(source);return script?script.text:source});var program=webglUtils.createProgramFromSources(gl,shaderSources,opt_attribs,opt_locations,opt_errorCallback);if(!program){return null}var uniformSetters=createUniformSetters(gl,program);var attribSetters=createAttributeSetters(gl,program);return{program:program,uniformSetters:uniformSetters,attribSetters:attribSetters}}function setBuffersAndAttributes(gl,setters,buffers){setAttributes(setters,buffers.attribs);if(buffers.indices){gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,buffers.indices)}}var browserPrefixes=["","MOZ_","OP_","WEBKIT_"];function getExtensionWithKnownPrefixes(gl,name){for(var ii=0;ii<browserPrefixes.length;++ii){var prefixedName=browserPrefixes[ii]+name;var ext=gl.getExtension(prefixedName);if(ext){return ext}}return undefined}function resizeCanvasToDisplaySize(canvas,multiplier){multiplier=multiplier||1;var width=canvas.clientWidth*multiplier|0;var height=canvas.clientHeight*multiplier|0;if(canvas.width!==width||canvas.height!==height){canvas.width=width;canvas.height=height;return true}return false}function augmentTypedArray(typedArray,numComponents){var cursor=0;typedArray.push=function(){for(var ii=0;ii<arguments.length;++ii){var value=arguments[ii];if(value instanceof Array||value.buffer&&value.buffer instanceof ArrayBuffer){for(var jj=0;jj<value.length;++jj){typedArray[cursor++]=value[jj]}}else{typedArray[cursor++]=value}}};typedArray.reset=function(opt_index){cursor=opt_index||0};typedArray.numComponents=numComponents;Object.defineProperty(typedArray,"numElements",{get:function(){return this.length/this.numComponents|0}});return typedArray}function createAugmentedTypedArray(numComponents,numElements,opt_type){var Type=opt_type||Float32Array;return augmentTypedArray(new Type(numComponents*numElements),numComponents)}function createBufferFromTypedArray(gl,array,type,drawType){type=type||gl.ARRAY_BUFFER;var buffer=gl.createBuffer();gl.bindBuffer(type,buffer);gl.bufferData(type,array,drawType||gl.STATIC_DRAW);return buffer}function allButIndices(name){return name!=="indices"}function createMapping(obj){var mapping={};Object.keys(obj).filter(allButIndices).forEach(function(key){mapping["a_"+key]=key});return mapping}function getGLTypeForTypedArray(gl,typedArray){if(typedArray instanceof Int8Array){return gl.BYTE}if(typedArray instanceof Uint8Array){return gl.UNSIGNED_BYTE}if(typedArray instanceof Int16Array){return gl.SHORT}if(typedArray instanceof Uint16Array){return gl.UNSIGNED_SHORT}if(typedArray instanceof Int32Array){return gl.INT}if(typedArray instanceof Uint32Array){return gl.UNSIGNED_INT}if(typedArray instanceof Float32Array){return gl.FLOAT}throw"unsupported typed array type"}function getNormalizationForTypedArray(typedArray){if(typedArray instanceof Int8Array){return true}if(typedArray instanceof Uint8Array){return true}return false}function isArrayBuffer(a){return a.buffer&&a.buffer instanceof ArrayBuffer}function guessNumComponentsFromName(name,length){var numComponents;if(name.indexOf("coord")>=0){numComponents=2}else if(name.indexOf("color")>=0){numComponents=4}else{numComponents=3}if(length%numComponents>0){throw"can not guess numComponents. You should specify it."}return numComponents}function makeTypedArray(array,name){if(isArrayBuffer(array)){return array}if(array.data&&isArrayBuffer(array.data)){return array.data}if(Array.isArray(array)){array={data:array}}if(!array.numComponents){array.numComponents=guessNumComponentsFromName(name,array.length)}var type=array.type;if(!type){if(name==="indices"){type=Uint16Array}}var typedArray=createAugmentedTypedArray(array.numComponents,array.data.length/array.numComponents|0,type);typedArray.push(array.data);return typedArray}function createAttribsFromArrays(gl,arrays,opt_mapping){var mapping=opt_mapping||createMapping(arrays);var attribs={};Object.keys(mapping).forEach(function(attribName){var bufferName=mapping[attribName];var origArray=arrays[bufferName];var array=makeTypedArray(origArray,bufferName);attribs[attribName]={buffer:createBufferFromTypedArray(gl,array),numComponents:origArray.numComponents||array.numComponents||guessNumComponentsFromName(bufferName),type:getGLTypeForTypedArray(gl,array),normalize:getNormalizationForTypedArray(array)}});return attribs}function getNumElementsFromNonIndexedArrays(arrays){var key=Object.keys(arrays)[0];var array=arrays[key];if(isArrayBuffer(array)){return array.numElements}else{return array.data.length/array.numComponents}}function createBufferInfoFromArrays(gl,arrays,opt_mapping){var bufferInfo={attribs:createAttribsFromArrays(gl,arrays,opt_mapping)};var indices=arrays.indices;if(indices){indices=makeTypedArray(indices,"indices");bufferInfo.indices=createBufferFromTypedArray(gl,indices,gl.ELEMENT_ARRAY_BUFFER);bufferInfo.numElements=indices.length}else{bufferInfo.numElements=getNumElementsFromNonIndexedArrays(arrays)}return bufferInfo}function createBuffersFromArrays(gl,arrays){var buffers={};Object.keys(arrays).forEach(function(key){var type=key==="indices"?gl.ELEMENT_ARRAY_BUFFER:gl.ARRAY_BUFFER;var array=makeTypedArray(arrays[key],name);buffers[key]=createBufferFromTypedArray(gl,array,type)});if(arrays.indices){buffers.numElements=arrays.indices.length}else if(arrays.position){buffers.numElements=arrays.position.length/3}return buffers}function drawBufferInfo(gl,bufferInfo,primitiveType,count,offset){var indices=bufferInfo.indices;primitiveType=primitiveType===undefined?gl.TRIANGLES:primitiveType;var numElements=count===undefined?bufferInfo.numElements:count;offset=offset===undefined?offset:0;if(indices){gl.drawElements(primitiveType,numElements,gl.UNSIGNED_SHORT,offset)}else{gl.drawArrays(primitiveType,offset,numElements)}}function drawObjectList(gl,objectsToDraw){var lastUsedProgramInfo=null;var lastUsedBufferInfo=null;objectsToDraw.forEach(function(object){var programInfo=object.programInfo;var bufferInfo=object.bufferInfo;var bindBuffers=false;if(programInfo!==lastUsedProgramInfo){lastUsedProgramInfo=programInfo;gl.useProgram(programInfo.program);bindBuffers=true}if(bindBuffers||bufferInfo!==lastUsedBufferInfo){lastUsedBufferInfo=bufferInfo;setBuffersAndAttributes(gl,programInfo.attribSetters,bufferInfo)}setUniforms(programInfo.uniformSetters,object.uniforms);drawBufferInfo(gl,bufferInfo)})}var isIE=false||!!document.documentMode;var isEdge=!isIE&&!!window.StyleMedia;if(isEdge){HTMLCanvasElement.prototype.getContext=function(origFn){return function(){var args=arguments;var type=args[0];if(type==="webgl"){args=[].slice.call(arguments);args[0]="experimental-webgl"}return origFn.apply(this,args)}}(HTMLCanvasElement.prototype.getContext)}return{createAugmentedTypedArray:createAugmentedTypedArray,createAttribsFromArrays:createAttribsFromArrays,createBuffersFromArrays:createBuffersFromArrays,createBufferInfoFromArrays:createBufferInfoFromArrays,createAttributeSetters:createAttributeSetters,createProgram:createProgram,createProgramFromScripts:createProgramFromScripts,createProgramFromSources:createProgramFromSources,createProgramInfo:createProgramInfo,createUniformSetters:createUniformSetters,createVAOAndSetAttributes:createVAOAndSetAttributes,createVAOFromBufferInfo:createVAOFromBufferInfo,drawBufferInfo:drawBufferInfo,drawObjectList:drawObjectList,getExtensionWithKnownPrefixes:getExtensionWithKnownPrefixes,resizeCanvasToDisplaySize:resizeCanvasToDisplaySize,setAttributes:setAttributes,setBuffersAndAttributes:setBuffersAndAttributes,setUniforms:setUniforms}})},{}],18:[function(require,module,exports){"use strict";const Renderable=require("./renderable");const Point=require("./point");const Color=require("./color");const Rectangle=require("./rectangle");const BlendModes=require("./blend_modes");const degreesToRadFactor=Math.PI/180;const predefinedRotationVectors={};for(var i=0;i<=360/5;++i){var deg=Math.round(i*5);var rad=deg*degreesToRadFactor;predefinedRotationVectors[deg]=new Point(Math.sin(-rad),Math.cos(-rad));if(Object.freeze){Object.freeze(predefinedRotationVectors[deg])}}class Sprite extends Renderable{constructor(texture,position,options){options=options||{};super(position||Point.zero(),options.color||Sprite.defaults.color,options.blendMode||Sprite.defaults.blendMode);this.texture=texture;var size=options.size||Sprite.defaults.size;this.size=new Point(size.x,size.y);this.scale=(options.scale||Sprite.defaults.scale).clone();this.sourceRectangle=(options.sourceRectangle||this.sourceRectangle).clone();this.smoothingEnabled=options.smoothingEnabled||Sprite.defaults.smoothingEnabled;this.origin=(options.origin||Sprite.defaults.origin).clone();this.rotation=options.rotation||0;this.brightness=options.brightness||1;this.colorBoost=(options.colorBoost||Sprite.defaults.colorBoost).clone();this.greyscale=Boolean(options.greyscale);this.cacheRelativeSourceRectangle=true;this.applyAntiBleeding=Sprite.defaults.applyAntiBleeding;this.skew=options.skew?options.skew.clone():Point.zero()}get texture(){return this._texture}set texture(texture){this._texture=texture;this.sourceRectangle=new Rectangle(0,0,0,0)}set width(val){this.size.x=val}get width(){return this.size.x}set height(val){this.size.y=val}get height(){return this.size.y}get sourceRectangleRelative(){if(!this.cacheRelativeSourceRectangle||!this._sourceRectangleRelative||!this._lastSrcRect.equals(this.sourceRectangle)){var twidth=this.texture.width;var theight=this.texture.height;if(!twidth||!theight){return new Rectangle(0,0,0,0)}if(this.cacheRelativeSourceRectangle){this._lastSrcRect=this.sourceRectangle.clone()}var antiBleedFactor=this.applyAntiBleeding?.5:0;this._sourceRectangleRelative=new Rectangle((this.sourceRectangle.x+antiBleedFactor)/twidth,(this.sourceRectangle.y+antiBleedFactor)/theight,((this.sourceRectangle.width||this.texture.width)-antiBleedFactor)/twidth,((this.sourceRectangle.height||this.texture.height)-antiBleedFactor)/theight)}return this._sourceRectangleRelative}set rotation(val){val=Math.round(val%360*100)/100;if(val<0){val=360+val}if(this._rotation!==val){this._rotationRadians=val*degreesToRadFactor;this._rotationVec=null;this._rotation=val}}get rotation(){return this._rotation}set rotationRadians(val){this.rotation=val/degreesToRadFactor}get rotationRadians(){return this._rotationRadians}get rotationVector(){var predefVec=predefinedRotationVectors[this.rotation];if(predefVec){return predefVec}if(!this._rotationVec){this._rotationVec=new Point(Math.sin(-this._rotationRadians),Math.cos(-this._rotationRadians));if(Object.freeze){Object.freeze(this._rotationVec)}}return this._rotationVec}setSourceFromSpritesheet(index,spritesCount,setSize){var w=this.texture.width/spritesCount.x;var h=this.texture.height/spritesCount.y;var x=w*index.x;var y=h*index.y;if(setSize||setSize===undefined){this.width=w;this.height=h}this.sourceRectangle.set(x,y,w,h)}clone(){var ret=new Sprite(this.texture);ret.scale=this.scale.clone();ret.sourceRectangle=this.sourceRectangle.clone();ret.smoothingEnabled=this.smoothingEnabled;ret.origin=this.origin.clone();ret.rotation=this.rotation;ret.brightness=this.brightness;ret.colorBoost=this.colorBoost.clone();ret.greyscale=this.greyscale;ret.skew=this.skew.clone();ret.cacheRelativeSourceRectangle=this.cacheRelativeSourceRectangle;ret.applyAntiBleeding=this.applyAntiBleeding;this._copyBasics(ret);return ret}}Sprite.defaults={blendMode:BlendModes.AlphaBlend,scale:Point.one(),sourceRectangle:new Rectangle,smoothingEnabled:true,color:Color.white(),origin:Point.zero(),colorBoost:Color.transparent(),applyAntiBleeding:false,size:new Point(64,64)};module.exports=Sprite},{"./blend_modes":1,"./color":2,"./point":5,"./rectangle":6,"./renderable":7}],19:[function(require,module,exports){"use strict";const Renderable=require("./renderable");const Point=require("./point");const Color=require("./color");const BlendModes=require("./blend_modes");class TextSprite extends Renderable{constructor(text,position,options){options=options||{};super(position||Point.zero(),options.color||TextSprite.defaults.color,options.blendMode||TextSprite.defaults.blendMode);this._version=0;this.text=text;this.font=options.font||TextSprite.defaults.font;this.fontSize=options.fontSize||TextSprite.defaults.fontSize;this.alignment=options.alignment||TextSprite.defaults.alignment;this.strokeWidth=options.strokeWidth||TextSprite.defaults.strokeWidth;this.maxWidth=null;this.strokeColor=(options.strokeColor||TextSprite.defaults.strokeColor).clone();this.useStyleCommands=TextSprite.defaults.useStyleCommands;this._version=0}getHashCode(){var text=this.text;var hash=0,i,chr;if(text.length===0)return hash;for(i=0;i<text.length;i++){chr=text.charCodeAt(i);hash=(hash<<5)-hash+chr;hash|=0}return hash}getUniqueId(){if(this._uniqueId&&this._lastUniqueIdVersion==this._version){return this._uniqueId}this._uniqueId=this.getHashCode().toString()+this.fontPropertyAsString+this.alignment+this.strokeWidth+this.color.asHex()+this.strokeColor.asHex()+this.maxWidth;this._lastUniqueIdVersion=this._version;return this._uniqueId}set alignment(val){this._alignment=val;this._version++}get alignment(){return this._alignment}set useStyleCommands(val){this._useStyleCommands=val;this._cachedLinesAndCommands=null}get useStyleCommands(){return this._useStyleCommands}set strokeColor(val){this._strokeColor=val;this._version++}get strokeColor(){return this._strokeColor}set maxWidth(val){this._maxWidth=val;this._cachedLinesAndCommands=null;this._version++}get maxWidth(){return this._maxWidth}set strokeWidth(val){this._strokeWidth=val;this._cachedLinesAndCommands=null;this._version++}get strokeWidth(){return this._strokeWidth}set text(val){this._text=val;this._cachedLinesAndCommands=null;this._version++}get text(){return this._text}get fontPropertyAsString(){if(!this._fontString){this._fontString=Math.ceil(this.fontSize)+"px "+this.font}return this._fontString}set font(val){this._font=val;this._fontString=null;this._cachedLinesAndCommands=null;this._version++}get font(){return this._font}set fontSize(val){this._fontSize=val;this._fontString=null;this._cachedLinesAndCommands=null;this._version++}get fontSize(){return this._fontSize}getProcessedTextAndCommands(getCharSize){if(this._cachedLinesAndCommands){return this._cachedLinesAndCommands}var ret=[];var currLine={styleCommands:{},text:"",sizes:[],totalWidth:0};var endLine=()=>{if(currLine.sizes.length!=currLine.text.length){throw new Error("Internal error!")}ret.push(currLine);currLine={styleCommands:{},text:"",sizes:[],totalWidth:0};this.calculatedHeight+=this.calculatedLineHeight};var getValuePart=j=>{var closingIndex=this._text.substr(j,64).indexOf("}}");if(closingIndex===-1){throw new PintarConsole.Error("Invalid broken style command: '"+this._text.substr(j-3,10)+"'!")}return this._text.substring(j+5,j+closingIndex)};var parseColor=colorVal=>{if(colorVal[0]==="#"){return Color.fromHex(colorVal)}return Color[colorVal]()};var strokeWidth=this.strokeWidth;this.calculatedHeight=this.calculatedLineHeight=0;for(var j=0;j<this._text.length;++j){if(this.useStyleCommands){var styleCommandKey=currLine.text.length;while(this._text[j]=="{"&&this._text[j+1]=="{"){currLine.styleCommands[styleCommandKey]=currLine.styleCommands[styleCommandKey]||[];if(this._text.substr(j,"{{res}}".length)==="{{res}}"){currLine.styleCommands[styleCommandKey].push({type:"reset"});strokeWidth=this.strokeWidth;j+="{{res}}".length}else{var command=this._text.substr(j,"{{xx:".length);var styleVal=getValuePart(j);j+=styleVal.length+2+5;if(command=="{{fc:"){var val=parseColor(styleVal);currLine.styleCommands[styleCommandKey].push({type:"fc",val:val})}else if(command=="{{sc:"){var val=parseColor(styleVal);currLine.styleCommands[styleCommandKey].push({type:"sc",val:val})}else if(command=="{{sw:"){var val=parseInt(styleVal);strokeWidth=val;currLine.styleCommands[styleCommandKey].push({type:"sw",val:val})}}}}var char=this._text[j];if(char===undefined){continue}var currCharSize=getCharSize(char,strokeWidth);if(!this.calculatedLineHeight){this.calculatedLineHeight=currCharSize.withStroke.y}if(this.maxWidth&&currLine.totalWidth>=this.maxWidth-currCharSize.withStroke.x){endLine()}if(char=="\n"){endLine()}else{currLine.sizes.push(currCharSize);currLine.text+=char;currLine.totalWidth+=currCharSize.width}}if(currLine.text.length){endLine()}this._cachedLinesAndCommands=ret;return ret}clone(){var ret=new TextSprite(this.text);ret._lineHeight=this._lineHeight;ret.position=this.position.clone();ret.font=this.font;ret.fontSize=this.fontSize;ret.color=this.color.clone();ret.alignment=this.alignment;ret.strokeWidth=this.strokeWidth;ret.maxWidth=this.maxWidth;ret.strokeColor=this.strokeColor.clone();return ret}}TextSprite._Alignments={Left:"left",Right:"right",Center:"center"};TextSprite.defaults={font:"Arial",fontSize:30,color:Color.black(),alignment:TextSprite._Alignments.Left,strokeWidth:0,strokeColor:Color.transparent(),blendMode:BlendModes.AlphaBlend,useStyleCommands:false};TextSprite.getTextWithoutStyleCommands=function(text){var ret="";var parts=text.split("{{");for(var i=0;i<parts.length;++i){var currPart=parts[i];var currPartOrigin=i===0?currPart:"{{"+currPart;var startPart=currPart.substr(0,3);if(startPart!=="fc:"&&startPart!=="sc:"&&startPart!=="sw:"&&startPart!=="res"){ret+=currPartOrigin;continue}var closing=currPart.indexOf("}}");ret+=closing===-1?currPartOrigin:currPart.substr(closing+2)}return ret};TextSprite.measureTextHeight=function(fontFamily,fontSize,char){var text=document.createElement("span");text.style.fontFamily=fontFamily;text.style.fontSize=fontSize+"px";text.style.paddingBottom=text.style.paddingLeft=text.style.paddingTop=text.style.paddingRight="0px";text.style.marginBottom=text.style.marginLeft=text.style.marginTop=text.style.marginRight="0px";text.textContent=char||"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ";document.body.appendChild(text);var result=text.getBoundingClientRect().height;document.body.removeChild(text);return result};TextSprite.measureTextWidth=function(fontFamily,fontSize,char){var canvas=document.createElement("canvas");var context=canvas.getContext("2d");context.font=fontSize.toString()+"px "+fontFamily;var result=0;var text=char||"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ";for(var i=0;i<text.length;++i){result=Math.max(result,context.measureText(text[i]).width)}return Math.ceil(result)};module.exports=TextSprite},{"./blend_modes":1,"./color":2,"./point":5,"./renderable":7}],20:[function(require,module,exports){"use strict";const Point=require("./point");const PintarConsole=require("./console");class Texture{constructor(imageOrSize,onLoaded){if(imageOrSize instanceof Image){PintarConsole.log("Create new texture from existing image:",imageOrSize);this.image=imageOrSize;if(this.image.width){if(onLoaded){onLoaded.call(this.image)}}else{this.image.onload=onLoaded}}else if(typeof imageOrSize==="string"||imageOrSize instanceof String){PintarConsole.log("Create new texture from image URI:",imageOrSize);this.image=new Image;this.image.onload=onLoaded;this.image.src=imageOrSize}else if(imageOrSize instanceof Point){PintarConsole.log("Create new texture from empty image with size:",imageOrSize);this.image=new Image(imageOrSize.x,imageOrSize.y);if(onLoaded){onLoaded()}}else{throw new PintarConsole.Error("Invalid param for texture creation; Should either be Image, string, or Point!")}}get isReady(){return this.image&&this.image.width!=0}get width(){return this.image.width}get height(){return this.image.height}}module.exports=Texture},{"./console":3,"./point":5}],21:[function(require,module,exports){"use strict";const Point=require("./point");class Viewport{constructor(offset,drawingRegion){this.offset=offset?offset.clone():Point.zero();this.drawingRegion=drawingRegion?drawingRegion.clone():null}clone(){return new Viewport(this.offset,this.drawingRegion)}equals(other){return other&&this.offset.equals(other.offset)&&this.drawingRegion.equals(other.drawingRegion)}}module.exports=Viewport},{"./point":5}]},{},[4])(4)});